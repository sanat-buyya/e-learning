<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Jnana</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link rel="shortcut icon" href="https://yogastudies.org/wp-content/uploads/jnana.jpg" type="image/x-icon" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #06b6d4;
      --accent: #f59e0b;
      --success: #10b981;
      --error: #ef4444;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --border: #e2e8f0;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      color: var(--text-primary);
      background: var(--bg-secondary);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Navigation - Matching register.html */
    .navbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 0;
      flex-shrink: 0;
      transition: all 0.3s ease;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.75rem;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-decoration: none;
      letter-spacing: -0.025em;
    }

    .nav-links {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .nav-btn {
      padding: 0.5rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s ease;
      font-size: 0.875rem;
      background: var(--primary);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .nav-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    /* Main Container */
    .main-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      min-height: 0;
      background: var(--bg-secondary);
      position: relative;
    }

    /* Login Form Container */
    .login-section {
      width: 100%;
      max-width: 450px;
      padding: 3rem;
      background: white;
      border-radius: 1rem;
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--border);
      animation: fadeInUp 0.6s ease-out;
      position: relative;
      overflow: hidden;
    }

    .login-section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
    }

    .login-icon {
      width: 70px;
      height: 70px;
      background: var(--gradient-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 2rem;
      color: white;
      font-size: 1.75rem;
    }

    .login-section h1 {
      font-size: 2rem;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      text-align: center;
      letter-spacing: -0.025em;
    }

    .login-subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 2.5rem;
      font-size: 1rem;
      line-height: 1.5;
    }

    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }

    .form-group input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--border);
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: all 0.2s ease;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: inherit;
    }

    .form-group input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }

    .form-group input::placeholder {
      color: var(--text-muted);
    }

    .form-group input.valid {
      border-color: var(--success);
      background: rgba(16, 185, 129, 0.05);
    }

    .form-group input.invalid {
      border-color: var(--error);
      background: rgba(239, 68, 68, 0.05);
    }

    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s ease;
      font-size: 0.9rem;
    }

    .password-toggle:hover {
      color: var(--text-secondary);
      background: var(--bg-tertiary);
    }

    .submit-btn {
      width: 100%;
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 0.5rem;
      background: var(--primary);
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 1rem;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: inherit;
    }

    .submit-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .error {
      color: var(--error);
      font-size: 0.875rem;
      margin-top: 0.5rem;
      display: block;
      font-weight: 500;
    }

    .forgot-password {
      text-align: center;
      margin-top: 1.5rem;
    }

    .forgot-password a {
      color: var(--primary);
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    .forgot-password a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }

    .register-link {
      text-align: center;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .register-link a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    .register-link a:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }

    /* Toast Notifications - Matching other pages */
    .toast-container {
      position: fixed;
      top: 100px;
      right: 2rem;
      z-index: 1001;
      max-width: 400px;
    }

    .toast {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--border);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      animation: slideInRight 0.3s ease-out forwards;
      position: relative;
      overflow: hidden;
    }

    .toast::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
    }

    .toast.success::before {
      background: var(--success);
    }

    .toast.error::before {
      background: var(--error);
    }

    .toast-content {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1;
    }

    .toast-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      color: white;
    }

    .toast.success .toast-icon {
      background: var(--success);
    }

    .toast.error .toast-icon {
      background: var(--error);
    }

    .toast-message {
      color: var(--text-primary);
      font-weight: 500;
      font-size: 0.875rem;
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 1.25rem;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 0.25rem;
      transition: all 0.2s ease;
      line-height: 1;
    }

    .toast-close:hover {
      color: var(--text-secondary);
      background: var(--bg-tertiary);
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }

      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .nav-container {
        padding: 0 1rem;
      }

      .main-container {
        padding: 1rem;
      }

      .login-section {
        max-width: 100%;
        padding: 2rem;
      }

      .toast-container {
        right: 1rem;
        left: 1rem;
        max-width: none;
      }
    }

    @media (max-width: 480px) {
      .nav-container {
        padding: 0 0.75rem;
      }

      .logo {
        font-size: 1.5rem;
      }

      .nav-btn {
        padding: 0.4rem 1rem;
        font-size: 0.8rem;
      }

      .login-section {
        padding: 1.5rem;
      }

      .login-section h1 {
        font-size: 1.75rem;
      }

      .submit-btn {
        padding: 0.75rem 1.5rem;
        font-size: 0.9rem;
      }
    }

    @media (max-height: 700px) {
      .main-container {
        padding: 1rem;
      }

      .login-section {
        padding: 2rem;
      }

      .login-icon {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .login-section h1 {
        font-size: 1.75rem;
        margin-bottom: 0.375rem;
      }

      .login-subtitle {
        margin-bottom: 2rem;
        font-size: 0.9rem;
      }

      .form-group {
        margin-bottom: 1.25rem;
      }

      .form-group input {
        padding: 0.75rem 0.875rem;
      }

      .submit-btn {
        padding: 0.75rem 1.5rem;
        margin-top: 0.75rem;
      }

      .forgot-password {
        margin-top: 1.25rem;
      }

      .register-link {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
      }
    }

    @media (max-height: 600px) {
      .navbar {
        padding: 0.5rem 0;
      }

      .main-container {
        padding: 0.5rem;
      }

      .login-section {
        padding: 1.5rem;
      }

      .login-icon {
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
        margin-bottom: 1rem;
      }

      .login-section h1 {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
      }

      .login-subtitle {
        margin-bottom: 1.5rem;
        font-size: 0.85rem;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-group input {
        padding: 0.625rem 0.75rem;
        font-size: 0.9rem;
      }

      .submit-btn {
        padding: 0.625rem 1.25rem;
        font-size: 0.85rem;
        margin-top: 0.5rem;
      }

      .forgot-password {
        margin-top: 1rem;
      }

      .register-link {
        margin-top: 1.25rem;
        padding-top: 1.25rem;
        font-size: 0.85rem;
      }
    }

    /* Custom scrollbar - just in case */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    html {
      scroll-behavior: smooth;
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="logo">Jnana</a>
      <div class="nav-links">
        <a href="/register" class="nav-btn">Get Started</a>
      </div>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Login Form -->
    <div class="login-section">
      <div class="login-icon">
        <i class="fas fa-sign-in-alt"></i>
      </div>

      <h1>Welcome Back</h1>
      <p class="login-subtitle">
        Sign in to your account to continue your learning journey
      </p>

      <form action="/login" method="post">
        <div class="form-group">
          <input type="email" name="email" placeholder="Email Address" required autocomplete="email" />
          <span class="error" th:if="${param.error}" th:text="${param.error}"></span>
        </div>

        <div class="form-group">
          <input type="password" name="password" placeholder="Password" required autocomplete="current-password"
            id="passwordInput" />
          <button type="button" class="password-toggle" id="passwordToggle">
            <i class="fas fa-eye"></i>
          </button>
          <span class="error" th:if="${param.passwordError}" th:text="${param.passwordError}"></span>
        </div>

        <button type="submit" class="submit-btn" id="loginBtn">
          <i class="fas fa-sign-in-alt"></i>
          <span>Sign In</span>
        </button>
      </form>

      <div class="forgot-password">
        <a href="/forgot-password">Forgot your password?</a>
      </div>

      <div class="register-link">
        <p>Don't have an account? <a href="/register">Create one here</a></p>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container">
    <div id="successToast" class="toast success" th:if="${session.pass}" style="display: none">
      <div class="toast-content">
        <div class="toast-icon">
          <i class="fas fa-check"></i>
        </div>
        <span class="toast-message" th:text="${session.pass}">Success message</span>
      </div>
      <button class="toast-close">&times;</button>
    </div>
    <div id="errorToast" class="toast error" th:if="${session.fail}" style="display: none">
      <div class="toast-content">
        <div class="toast-icon">
          <i class="fas fa-exclamation"></i>
        </div>
        <span class="toast-message" th:text="${session.fail}">Error message</span>
      </div>
      <button class="toast-close">&times;</button>
    </div>
    <th:block th:text="${@generalService.removeMessage()}"></th:block>
  </div>

  <script>
    // Toast Management - Matching other pages
    function removeToast(toast) {
      toast.style.animation = "slideOutRight 0.3s ease forwards";
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }

    function showToast(type, message) {
      const toastContainer = document.querySelector(".toast-container");
      const toast = document.createElement("div");
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <div class="toast-content">
          <div class="toast-icon">
            <i class="fas fa-${type === "success" ? "check" : "exclamation"}"></i>
          </div>
          <span class="toast-message">${message}</span>
        </div>
        <button class="toast-close">&times;</button>
      `;

      toastContainer.appendChild(toast);

      // Auto remove after 5 seconds
      setTimeout(() => removeToast(toast), 5000);

      // Close button functionality
      toast.querySelector(".toast-close").addEventListener("click", () => {
        removeToast(toast);
      });
    }

    // Initialize everything
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.querySelector("form");
      const inputs = form.querySelectorAll("input");
      const loginBtn = document.getElementById("loginBtn");
      const passwordInput = document.getElementById("passwordInput");
      const passwordToggle = document.getElementById("passwordToggle");

      // Handle existing toasts
      const successToast = document.getElementById("successToast");
      const errorToast = document.getElementById("errorToast");

      if (successToast && successToast.querySelector(".toast-message").textContent.trim()) {
        successToast.style.display = "flex";
        setTimeout(() => removeToast(successToast), 5000);
      }

      if (errorToast && errorToast.querySelector(".toast-message").textContent.trim()) {
        errorToast.style.display = "flex";
        setTimeout(() => removeToast(errorToast), 5000);
      }

      // Close button functionality for existing toasts
      document.querySelectorAll(".toast-close").forEach((closeBtn) => {
        closeBtn.addEventListener("click", function () {
          const toast = this.closest(".toast");
          removeToast(toast);
        });
      });

      // Password toggle functionality
      if (passwordToggle && passwordInput) {
        passwordToggle.addEventListener("click", function () {
          const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
          passwordInput.setAttribute("type", type);

          const icon = this.querySelector("i");
          icon.classList.toggle("fa-eye");
          icon.classList.toggle("fa-eye-slash");
        });
      }

      // Input validation styling
      inputs.forEach((input) => {
        input.addEventListener("blur", function () {
          if (this.value.trim() !== "") {
            if (this.type === "email") {
              const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
              if (emailRegex.test(this.value)) {
                this.classList.add("valid");
                this.classList.remove("invalid");
              } else {
                this.classList.add("invalid");
                this.classList.remove("valid");
              }
            } else {
              this.classList.add("valid");
              this.classList.remove("invalid");
            }
          } else if (this.hasAttribute("required")) {
            this.classList.add("invalid");
            this.classList.remove("valid");
          }
        });

        input.addEventListener("focus", function () {
          this.classList.remove("valid", "invalid");
        });

        input.addEventListener("input", function () {
          this.classList.remove("valid", "invalid");
        });
      });

      // Form submission handling
      form.addEventListener("submit", function (e) {
        let isValid = true;

        // Validate all required fields
        inputs.forEach((input) => {
          if (input.hasAttribute("required") && !input.value.trim()) {
            input.classList.add("invalid");
            input.style.animation = "shake 0.5s ease-in-out";
            setTimeout(() => {
              input.style.animation = "";
            }, 500);
            isValid = false;
          }
        });

        // Validate email format
        const emailInput = form.querySelector('input[type="email"]');
        if (emailInput && emailInput.value.trim()) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(emailInput.value)) {
            emailInput.classList.add("invalid");
            emailInput.style.animation = "shake 0.5s ease-in-out";
            setTimeout(() => {
              emailInput.style.animation = "";
            }, 500);
            isValid = false;
            showToast("error", "Please enter a valid email address");
          }
        }

        if (!isValid) {
          e.preventDefault();
          return;
        }

        // Show loading state
        loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Signing In...</span>';
        loginBtn.disabled = true;
      });

      // Auto-focus first input
      const firstInput = inputs[0];
      if (firstInput) {
        setTimeout(() => {
          firstInput.focus();
        }, 100);
      }

      // Enter key handling for better UX
      inputs.forEach((input, index) => {
        input.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            if (index < inputs.length - 1) {
              inputs[index + 1].focus();
            } else {
              form.submit();
            }
          }
        });
      });
    });

    // Add ripple effect to buttons - Matching other pages
    function createRipple(event) {
      const button = event.currentTarget;
      const circle = document.createElement("span");
      const diameter = Math.max(button.clientWidth, button.clientHeight);
      const radius = diameter / 2;

      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
      circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
      circle.classList.add("ripple");

      const ripple = button.getElementsByClassName("ripple")[0];
      if (ripple) {
        ripple.remove();
      }

      button.appendChild(circle);
    }

    document.querySelectorAll(".submit-btn, .nav-btn").forEach((btn) => {
      btn.addEventListener("click", createRipple);
    });

    // Add hover effects to form inputs
    document.querySelectorAll("input").forEach((input) => {
      input.addEventListener("mouseenter", function () {
        if (!this.matches(":focus") && !this.classList.contains("valid") && !this.classList.contains("invalid")) {
          this.style.borderColor = "var(--text-muted)";
        }
      });

      input.addEventListener("mouseleave", function () {
        if (!this.matches(":focus") && !this.classList.contains("valid") && !this.classList.contains("invalid")) {
          this.style.borderColor = "var(--border)";
        }
      });
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", function (e) {
      // Escape key to clear form
      if (e.key === "Escape") {
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          input.value = "";
          input.classList.remove("valid", "invalid");
        });
        inputs[0].focus();

        // Also close any visible toasts
        const visibleToasts = document.querySelectorAll('.toast[style*="flex"]');
        visibleToasts.forEach((toast) => {
          removeToast(toast);
        });
      }
    });

    // Real-time validation
    document.addEventListener("DOMContentLoaded", function () {
      const emailInput = document.querySelector('input[type="email"]');
      const passwordInput = document.querySelector('input[type="password"]');

      if (emailInput) {
        emailInput.addEventListener("input", function () {
          if (this.value.length > 0) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailRegex.test(this.value)) {
              this.classList.add("valid");
              this.classList.remove("invalid");
            } else {
              this.classList.remove("valid");
              if (this.value.includes("@") && this.value.includes(".")) {
                this.classList.add("invalid");
              } else {
                this.classList.remove("invalid");
              }
            }
          } else {
            this.classList.remove("valid", "invalid");
          }
        });
      }

      if (passwordInput) {
        passwordInput.addEventListener("input", function () {
          if (this.value.length > 0) {
            if (this.value.length >= 6) {
              this.classList.add("valid");
              this.classList.remove("invalid");
            } else {
              this.classList.remove("valid");
              if (this.value.length >= 3) {
                this.classList.add("invalid");
              } else {
                this.classList.remove("invalid");
              }
            }
          } else {
            this.classList.remove("valid", "invalid");
          }
        });
      }
    });

    // Caps Lock detection
    document.addEventListener("keydown", function (e) {
      if (e.getModifierState && e.getModifierState("CapsLock")) {
        const passwordInput = document.getElementById("passwordInput");
        if (document.activeElement === passwordInput) {
          showToast("error", "Caps Lock is on");
        }
      }
    });

    // Performance optimization: Debounce resize events
    let resizeTimeout;
    window.addEventListener("resize", function () {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(function () {
        const isMobile = window.innerWidth <= 768;
        document.body.classList.toggle("mobile", isMobile);

        // Adjust toast positioning
        const toastContainer = document.querySelector(".toast-container");
        if (isMobile) {
          toastContainer.style.right = "1rem";
          toastContainer.style.left = "1rem";
          toastContainer.style.maxWidth = "none";
        } else {
          toastContainer.style.right = "2rem";
          toastContainer.style.left = "auto";
          toastContainer.style.maxWidth = "400px";
        }
      }, 250);
    });

    // Initialize mobile class
    document.body.classList.toggle("mobile", window.innerWidth <= 768);

    // Error handling for network issues
    window.addEventListener("online", function () {
      showToast("success", "Connection restored");
    });

    window.addEventListener("offline", function () {
      showToast("error", "No internet connection. Please check your network.");
    });

    // Prevent double submission
    let isSubmitting = false;
    document.querySelector("form").addEventListener("submit", function (e) {
      if (isSubmitting) {
        e.preventDefault();
        return false;
      }
      isSubmitting = true;

      // Reset flag after 5 seconds as fallback
      setTimeout(() => {
        isSubmitting = false;
      }, 5000);
    });

    // Add visual feedback for form interaction
    document.querySelectorAll("input").forEach((input) => {
      input.addEventListener("focus", function () {
        this.parentElement.style.transform = "scale(1.01)";
      });

      input.addEventListener("blur", function () {
        this.parentElement.style.transform = "scale(1)";
      });
    });

    // Remember form data in sessionStorage (optional)
    document.addEventListener("DOMContentLoaded", function () {
      const emailInput = document.querySelector('input[type="email"]');

      // Load saved email
      const savedEmail = sessionStorage.getItem("loginEmail");
      if (savedEmail && emailInput) {
        emailInput.value = savedEmail;
        emailInput.classList.add("valid");
      }

      // Save email on input
      if (emailInput) {
        emailInput.addEventListener("input", function () {
          if (this.value.trim()) {
            sessionStorage.setItem("loginEmail", this.value);
          } else {
            sessionStorage.removeItem("loginEmail");
          }
        });
      }
    });

    // Add loading states to navigation
    document.querySelectorAll(".nav-btn").forEach((btn) => {
      btn.addEventListener("click", function () {
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        this.classList.add("loading");
      });
    });

    // Add CSS for enhanced states and animations
    const style = document.createElement("style");
    style.textContent = `
      /* Enhanced focus states for accessibility */
      .submit-btn:focus-visible,
      input:focus-visible,
      .password-toggle:focus-visible,
      .toast-close:focus-visible,
      .nav-btn:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
      }
      
      /* Loading spinner animation */
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      .fa-spinner {
        animation: spin 1s linear infinite;
      }
      
      /* Ripple effect */
      .submit-btn, .nav-btn {
        position: relative;
        overflow: hidden;
      }
      
      .ripple {
        position: absolute;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.6);
        transform: scale(0);
        animation: ripple-animation 0.6s linear;
        pointer-events: none;
      }
      
      @keyframes ripple-animation {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
      
      /* Success animation for inputs */
      input.valid {
        animation: successPulse 0.3s ease-out;
      }
      
      @keyframes successPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); }
      }
      
      /* Enhanced password toggle */
      .password-toggle:hover {
        background: rgba(99, 102, 241, 0.1);
      }
      
      /* Mobile optimizations */
      @media (max-width: 480px) {
        input {
          font-size: 16px; /* Prevents zoom on iOS */
        }
        
        .toast-container {
          top: 80px;
        }
      }
      
      /* High contrast mode support */
      @media (prefers-contrast: high) {
        input {
          border-width: 3px;
        }
        
        .submit-btn, .nav-btn {
          border: 2px solid currentColor;
        }
      }
      
      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
      
      /* Print styles */
      @media print {
        .navbar,
        .toast-container,
        .password-toggle {
          display: none !important;
        }
        
        .main-container {
          background: white !important;
        }
        
        .login-section {
          box-shadow: none;
          border: 2px solid #000;
        }
        
        input {
          border: 1px solid #000 !important;
        }
      }
      
      /* Enhanced hover states */
      .nav-btn:hover {
        box-shadow: var(--shadow-md);
      }
      
      .forgot-password a:hover,
      .register-link a:hover {
        transform: translateY(-1px);
      }
      
      /* Form group transitions */
      .form-group {
        transition: transform 0.2s ease;
      }
      
      /* Loading state for navigation */
      .nav-btn.loading {
        opacity: 0.7;
        pointer-events: none;
      }
      
      /* Enhanced error states */
      input.invalid {
        animation: shake 0.5s ease-in-out;
      }
      
      /* Smooth transitions for all interactive elements */
      input, button, a {
        transition: all 0.2s ease;
      }
      
      /* Enhanced mobile responsiveness */
      @media (max-width: 320px) {
        .login-section {
          padding: 1rem;
        }
        
        .login-icon {
          width: 40px;
          height: 40px;
          font-size: 1rem;
        }
        
        .login-section h1 {
          font-size: 1.5rem;
        }
        
        .form-group input {
          padding: 0.625rem 0.75rem;
          font-size: 0.9rem;
        }
        
        .submit-btn {
          padding: 0.625rem 1rem;
          font-size: 0.85rem;
        }
      }
    `;
    document.head.appendChild(style);

    // Add subtle entrance animations
    document.addEventListener("DOMContentLoaded", function () {
      const formElements = document.querySelectorAll(".form-group, .submit-btn, .forgot-password, .register-link");
      formElements.forEach((element, index) => {
        element.style.opacity = "0";
        element.style.transform = "translateY(20px)";

        setTimeout(() => {
          element.style.transition = "all 0.6s ease";
          element.style.opacity = "1";
          element.style.transform = "translateY(0)";
        }, index * 100 + 300);
      });
    });

    // Enhanced keyboard navigation
    document.addEventListener("keydown", function (e) {
      // Tab navigation enhancement
      if (e.key === "Tab") {
        const focusableElements = document.querySelectorAll(
          'input, button, a[href], [tabindex]:not([tabindex="-1"])'
        );
        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];

        if (e.shiftKey && document.activeElement === firstElement) {
          e.preventDefault();
          lastElement.focus();
        } else if (!e.shiftKey && document.activeElement === lastElement) {
          e.preventDefault();
          firstElement.focus();
        }
      }
    });

    // Auto-clear validation states on form reset
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.querySelector("form");
      if (form) {
        form.addEventListener("reset", function () {
          const inputs = form.querySelectorAll("input");
          inputs.forEach((input) => {
            input.classList.remove("valid", "invalid");
          });
        });
      }
    });

    // Enhanced error handling
    window.addEventListener("error", function (e) {
      console.error("JavaScript error:", e.error);
      showToast("error", "Something went wrong. Please try again.");
    });

    // Service worker registration for PWA support (optional)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker
          .register("/sw.js")
          .then(function (registration) {
            console.log("ServiceWorker registration successful");
          })
          .catch(function (err) {
            console.log("ServiceWorker registration failed");
          });
      });
    }

    // Analytics tracking (replace with your analytics service)
    function trackEvent(eventName, properties = {}) {
      // Example: Google Analytics 4
      if (typeof gtag !== "undefined") {
        gtag("event", eventName, properties);
      }

      // Example: Custom analytics
      if (typeof analytics !== "undefined") {
        analytics.track(eventName, properties);
      }
    }

    // Track login attempts
    document.querySelector("form").addEventListener("submit", function () {
      trackEvent("login_attempt", {
        timestamp: new Date().toISOString(),
      });
    });

    // Track password visibility toggles
    const passwordToggle = document.getElementById("passwordToggle");
    if (passwordToggle) {
      passwordToggle.addEventListener("click", function () {
        trackEvent("password_visibility_toggle", {
          timestamp: new Date().toISOString(),
        });
      });
    }

    // Auto-focus enhancement
    window.addEventListener("load", function () {
      const firstInput = document.querySelector("input");
      if (firstInput) {
        setTimeout(() => {
          firstInput.focus();
        }, 100);
      }
    });
  </script>
</body>

</html>